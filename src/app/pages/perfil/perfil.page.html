<main class="perfil-container">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-10-mobile is-8-tablet is-6-desktop is-5-widescreen">

        <!-- Card -->
        <div class="perfil-card"
             [class.admin-card]="esAdmin"
             [class.animate-admin-card]="animarAdminCard">

          <div class="card-content">

            <!-- Encabezado ADMIN -->
            <h2 *ngIf="esAdmin"
                class="admin-title"
                [class.admin-title-animate]="animarEncabezadoAdmin">
              ⚡ PERFIL DE ADMINISTRADOR
            </h2>

            <!-- Foto -->
            <div class="foto-container">
              <div class="foto-wrapper">
                <img
                  [src]="usuario?.foto ? getAvatarUrl(usuario.foto) : defaultAvatar"
                  class="foto-perfil"
                >
              </div>
            </div>

            <!-- Cambiar Avatar -->
            <div class="avatar-actions">
              <button class="btn-cambiar-avatar" (click)="togglePicker()">
                {{ mostrarPicker ? 'Cerrar selección de avatar' : 'Cambiar avatar' }}
              </button>
            </div>

            <!-- Selector -->
            <div class="icon-picker" *ngIf="mostrarPicker">
              <p class="icon-picker-title">Seleccionar ícono de perfil</p>

              <div class="icon-grid">
                <button
                  *ngFor="let icono of iconos"
                  class="icon-button"
                  [class.selected]="icono === iconoSeleccionado"
                  (click)="cambiarIcono(icono)"
                >
                  <img [src]="getAvatarUrl(icono)" />
                </button>
              </div>
            </div>

            <!-- Datos -->
            <h1 class="nombre-usuario">{{ usuario?.nombre }} {{ usuario?.apellido }}</h1>
            <p class="email-usuario">{{ usuario?.email }}</p>

            <div class="rol-container">
              <span class="rol-tag"
                    [class.rol-admin]="esAdmin"
                    [class.animate-admin-role]="animarRolAdmin">
                ROL: {{ usuario?.rol | uppercase }}
              </span>
            </div>

            <div class="miembro-desde" *ngIf="usuario?.created_at">
              <p>Miembro desde {{ usuario.created_at | date:'dd MMMM yyyy' }}</p>
            </div>

            <!-- Acciones -->
            <div class="acciones">

              <a routerLink="/cambiar-password" class="btn-principal">
                Cambiar Contraseña
              </a>

              <a *ngIf="esAdmin"
                 routerLink="/admin/tablas"
                 class="btn-admin">
                Editar Tablas
              </a>

              <button class="btn-cerrar-sesion" (click)="cerrarSesion()">
                Cerrar Sesión
              </button>

            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</main>

<!-- Overlay logout -->
<div class="logout-overlay" *ngIf="cerrandoSesion">
  <div class="logout-animation">
    <div class="logout-icon">
      <svg width="80" height="80" viewBox="0 0 80 80">
        <circle cx="40" cy="40" r="40" fill="#e60000"/>
        <path d="M25 40L35 50L55 30" stroke="white" stroke-width="4"/>
      </svg>
    </div>
    <h2 class="logout-text">¡Hasta pronto!</h2>
    <p class="logout-subtext">Cerrando sesión...</p>
  </div>
</div>
